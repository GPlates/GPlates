@SET_MAKE@

subdir = src
prefix = @prefix@

SUBDIRS = fileio geo global gui maths controls state

DISTFILES = Makefile.in *.cc

INCLUDES = -I.
CXXFLAGS = @CXXFLAGS@ $(INCLUDES) @EXTRA_CFLAGS@
LDFLAGS = @LDFLAGS@ @EXTRA_LDFLAGS@
INSTALL = @INSTALL@

EXTRA_LIBS = global/libglobal.a gui/libgui.a fileio/libfileio.a controls/libcontrols.a \
	state/libstate.a geo/libgeo.a maths/libmaths.a

LIBS = @LIBS@
#LIBS = @LIBS@ -lefence

OBJS = gplates_main.o

PROGNAME = gplates

all:	subdir_all $(PROGNAME)

subdir_all:
	@dlist='$(SUBDIRS)' ; \
	for subdir in $$dlist ; do \
		(cd $$subdir && $(MAKE) all) ; \
	done

install:
	@INSTALL@ -d @prefix@/bin
	@INSTALL@ -s $(PROGNAME) @prefix@/bin

uninstall:
	rm -f @prefix@/bin/$(PROGNAME)

clean:	subdir_clean
	rm -f $(OBJS)
	rm -f $(PROGNAME)
	rm -f core gmon.out

subdir_clean:
	@dlist='$(SUBDIRS)' ; \
	for subdir in $$dlist ; do \
		(cd $$subdir && $(MAKE) clean) ; \
	done

$(PROGNAME):	$(OBJS) $(EXTRA_LIBS)
#	@CXX@ $(LDFLAGS) $^ $(LIBS) -o $@
#	The extra linker flags allow the libraries to be specified in any
#	order.  This circumvents some 'circular' dependcies that have arisen.
	@CXX@ $(LDFLAGS) -Wl,--start-group $^ -Wl,--end-group $(LIBS) -o $@

dep:	subdir_dep

subdir_dep:
	@dlist='$(SUBDIRS)' ; \
	for subdir in $$dlist ; do \
		(cd $$subdir && $(MAKE) dep) ; \
	done

distdir = ../@PACKAGE_TARNAME@-@PACKAGE_VERSION@/$(subdir)
dist:	Makefile $(DISTFILES)
	for file in $(DISTFILES) ; do \
		ln $$file $(distdir) 2>/dev/null || \
			cp -p $$file $(distdir); \
	done

include Rules
